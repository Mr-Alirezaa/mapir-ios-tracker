<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MapirLiveTracker  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="MapirLiveTracker  Reference"></a>

    <header class="header-container">
      <div class="limiter">
        <div class="header">
          <p class="header-col header-col--primary">
            <a class="header-link" href="index.html">
                <img style="height: 40px;" class="header-icon" src="img/mapir.svg" alt="MapirLiveTracker Docs"/>
                <span class="header-tag">MapirLiveTracker 1.0 Docs Reference (1.0)</span>
            </a>
            
          </p>
    
          <p class="header-col header-col--secondary">
            <a class="header-link" href="https://github.com/map-ir/mapir-ios-tracker">
              <img class="header-icon" src="img/gh.png"/>
              View on GitHub
            </a>
          </p>
    
          <p class="header-col header-col--secondary">
            <a class="header-link" href="dash-feed://https%3A%2F%2Fmap%2Dir%2Egithub%2Eio%2Fdocsets%2FMapirLiveTracker%2Exml">
              <img class="header-icon" src="img/dash.png"/>
              Install in Dash
            </a>
          </p>
        </div>
      </div>
    </header>

    <div class="breadcrumbs">
      <div class="limiter">
        <a class="breadcrumb" href="index.html">MapirLiveTracker Reference</a>
        <img class="carat" src="img/carat.png" />
        MapirLiveTracker  Reference
      </div>
    </div>

    <div class="content-wrapper limiter">
      <nav class="navigation">
          <div class="header-col--secondary">
            <form role="search" action="search.json">
              <input type="text" placeholder="Search documentation" data-typeahead>
            </form>
          </div>
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="small-heading" href="Publisher.html">Publisher<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Publisher.html">Publisher</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Publisher/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PublisherDelegate.html">PublisherDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="small-heading" href="Subscriber.html">Subscriber<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Subscriber.html">Subscriber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Subscriber/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SubscriberDelegate.html">SubscriberDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="small-heading" href="Networking.html">Networking<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NetworkingManager.html">NetworkingManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NetworkConfiguration.html">NetworkConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NetworkConfiguration/MQTTQoS.html">– MQTTQoS</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="small-heading" href="Account.html">Account<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/AccountManager.html">AccountManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/AccountManager/APIKeyStatus.html">– APIKeyStatus</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="small-heading" href="Logging.html">Logging<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Logger.html">Logger</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Logger/Level.html">– Level</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="small-heading" href="Type Aliases.html">Type Aliases<span class="anchor-icon" /></a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type%20Aliases.html#/s:16MapirLiveTracker6Metersa">Meters</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p align="center">
<img width="200" src="https://corp.map.ir/wp-content/uploads/2019/06/map-site-logo-1.png" alt="Map.ir Logo">
</p>

<p align="center">
   <a href="https://developer.apple.com/swift/">
      <img src="https://img.shields.io/badge/Swift-5.1-orange.svg?style=flat" alt="Swift 5.1">
   </a>
   <!-- 
   <a href="http://cocoapods.org/pods/MapirLiveTracker">
      <img src="https://img.shields.io/cocoapods/v/MapirLiveTracker.svg?style=flat" alt="Version">
   </a>
   &ndash;>
   <!--
   <a href="http://cocoapods.org/pods/MapirLiveTracker">
      <img src="https://img.shields.io/cocoapods/p/MapirLiveTracker.svg?style=flat" alt="Platform">
   </a>
   &ndash;>
   <a href="https://github.com/Carthage/Carthage">
      <img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage Compatible">
   </a>
</p>
<h1 id='mapirlivetracker' class='heading'>MapirLiveTracker</h1>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>Map.ir Live Tracker uses MQTT protocol which has low data usage.</li>
<li>Easy configuration.</li>
<li>Complete and expressive documentation.</li>
<li>You can use both Swift and Objective-C languages.</li>
</ul>
<h2 id='example' class='heading'>Example</h2>

<p>The example applications are the best way to see <code>MapirLiveTracker</code> in action. Simply open the <code>MapirLiveTracker.xcodeproj</code> and run the <code>Swift Example</code> scheme.
There is also an Objective-C Example that is still being developed. </p>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>

<p>This SDK will be available on CocoaPods soon.</p>

<!--
MapirLiveTracker is available through [CocoaPods](http://cocoapods.org). To install
it, simply add the following line to your Podfile:

```bash
pod 'MapirLiveTracker'
```
-->
<h3 id='carthage' class='heading'>Carthage</h3>

<p><a href="https://github.com/Carthage/Carthage">Carthage</a> is a decentralized dependency manager that builds your dependencies and provides you with binary frameworks.</p>

<p>To integrate MapirLiveTracker into your Xcode project using Carthage, specify it in your <code>Cartfile</code>:</p>
<pre class="highlight plaintext"><code>github "map-ir/mapir-ios-tracker"
</code></pre>

<p>Run <code>carthage update</code> to build the framework and drag the built <code>MapirLiveTracker.framework</code> into your Xcode project. </p>

<p>On your application targets’ “Build Phases” settings tab, click the “+” icon and choose “New Run Script Phase” and add the Framework path as mentioned in <a href="https://github.com/Carthage/Carthage/blob/master/README.md#if-youre-building-for-ios-tvos-or-watchos">Carthage Getting started Step 4, 5 and 6</a></p>
<h2 id='usage' class='heading'>Usage</h2>

<p>In order to use live tracking services you need to have a Map.ir API Key. If you dont have the key, get one for free on <q>[App Registration](https://corp.map.ir/registration)</q>.
First add API key to your project, using these options:</p>

<ul>
<li><strong>Using Info.plist:</strong> Add a pair to the Info.plist. use <code>MAPIRAccessToken</code> as key and your API key as value of the pair.</li>
<li><strong>Using class initializers:</strong> Use <code>Publisher(APIKey:distanceFilter:)</code> or <code>Subscriber(APIKey:)</code> and pass your API key in the first arguement.</li>
</ul>

<p>A Publisher is used to send location of the current phone using a tracking identifier over the Map.ir Live Tracking service. You have to consider that a tracking idenftier for every commute must be a unique identifier which is identifiable by yourself. Every publishing session with a tracking identifier is trackable using a Subscriber with the same tacking identifer. Every user&rsquo;s tracking identifiers are available to themselves. Your identifiers will not conflict with another user&rsquo;s identifiers.</p>

<p>You only have to initialize a Publisher or a Subscriber to use services. In advanced uses you may provide your own network configuration.</p>
<h3 id='publisher' class='heading'>Publisher</h3>

<p>A Publisher needs access to location service. You have to ask users to provide proper permission. See <q>[Requesting Authorization for Location Services](https://developer.apple.com/documentation/corelocation/requesting_authorization_for_location_services)</q>.</p>

<p>As said before you need to have an API key and a tracking identifier for a session.</p>
<pre class="highlight swift"><code>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">MapirLiveTracker</span>

<span class="k">let</span> <span class="nv">mapirAPIKey</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span><span class="s">"your API Key here"</span><span class="err">#</span><span class="o">&gt;</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">publisher</span><span class="p">:</span> <span class="kt">Publisher</span><span class="o">!</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// First initialize the Publisher class. you also have to provide a distance filter. </span>
        <span class="c1">// Distance filter is the value that publisher publishes location information whenever</span>
        <span class="c1">// the user location changes that amount.</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="kt">Publisher</span><span class="p">(</span><span class="kt">APIKey</span><span class="p">:</span> <span class="n">mapirAPIKey</span><span class="p">,</span> <span class="nv">distanceFilter</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">)</span>

        <span class="c1">// Set `self` as delegate for the publisher. In order to do so, `ViewController` must </span>
        <span class="c1">// conform to `PublisherDelegate` protocol. In this case conformance is provided using</span>
        <span class="c1">// an extenstion for `ViewController` class.</span>
        <span class="n">publisher</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>

        <span class="c1">// Create a unique tracking identifier for the commute.</span>
        <span class="k">let</span> <span class="nv">trackingIdentifier</span> <span class="o">=</span> <span class="s">"Some unique ID"</span>

        <span class="c1">// Use the `start` method and provide the tracking identifier.</span>
        <span class="n">publisher</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">withTrackingIdentifier</span><span class="p">:</span> <span class="n">trackingIdentifier</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">PublisherDelegate</span> <span class="p">{</span>

    <span class="c1">// This method send the information whenever publisher stops.</span>
    <span class="kd">func</span> <span class="nf">publisher</span><span class="p">(</span><span class="n">_</span> <span class="nv">publisher</span><span class="p">:</span> <span class="kt">Publisher</span><span class="p">,</span> <span class="n">stoppedWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Publisher Stopped with error: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span> <span class="p">??</span> <span class="s">"nil"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span> 

    <span class="c1">// This method gets called whenever publisher sends the a location info successfully. </span>
    <span class="c1">// You will receive the same `CLLocation` object here.</span>
    <span class="kd">func</span> <span class="nf">publisher</span><span class="p">(</span><span class="n">_</span> <span class="nv">publisher</span><span class="p">:</span> <span class="kt">Publisher</span><span class="p">,</span> <span class="n">publishedLocation</span> <span class="nv">location</span><span class="p">:</span> <span class="kt">CLLocation</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">timestampString</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">description</span><span class="se">)</span><span class="s">"</span>
        <span class="k">let</span> <span class="nv">coordinatesString</span> <span class="o">=</span> <span class="s">"(</span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">latitude</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span><span class="se">)</span><span class="s">)"</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Last published location is </span><span class="se">\(</span><span class="n">coordinatesString</span><span class="se">)</span><span class="s"> on </span><span class="se">\(</span><span class="n">timestampString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='subscriber' class='heading'>Subscriber</h3>

<p>Unlike Publisher subscriber doesn&rsquo;t need access to loaction services. So you should only have a API key and a valid tracking identifier which somebody else is publishing to it. (Other person must have the same API key with you.)</p>
<pre class="highlight swift"><code>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">MapirLiveTracker</span>

<span class="k">let</span> <span class="nv">mapirAPIKey</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span><span class="s">"your API Key here"</span><span class="err">#</span><span class="o">&gt;</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">subscriber</span><span class="p">:</span> <span class="kt">Subscriber</span><span class="o">!</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// First initialize the Subscriber class.</span>
        <span class="n">subscriber</span> <span class="o">=</span> <span class="kt">Publisher</span><span class="p">(</span><span class="kt">APIKey</span><span class="p">:</span> <span class="n">mapirAPIKey</span><span class="p">)</span>

        <span class="c1">// Set `self` as delegate for the subscriber. In order to do so, `ViewController` must </span>
        <span class="c1">// conform to `SubscriberDelegate` protocol. In this case conformance is provided using</span>
        <span class="c1">// an extenstion for `ViewController` class.</span>
        <span class="n">subscriber</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>

        <span class="c1">// Create a unique tracking identifier for the commute.</span>
        <span class="k">let</span> <span class="nv">trackingIdentifier</span> <span class="o">=</span> <span class="s">"Some unique ID"</span>

        <span class="c1">// Use the `start` method and provide the tracking identifier.</span>
        <span class="n">subscriber</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">withTrackingIdentifier</span><span class="p">:</span> <span class="n">trackingIdentifier</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">SubscriberDelegate</span> <span class="p">{</span>

    <span class="c1">// This method send the information whenever publisher stops.</span>
    <span class="kd">func</span> <span class="nf">subscriber</span><span class="p">(</span><span class="n">_</span> <span class="nv">subscriber</span><span class="p">:</span> <span class="kt">Subscriber</span><span class="p">,</span> <span class="n">stoppedWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Subscriber Stopped with error: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span> <span class="p">??</span> <span class="s">"nil"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span> 

    <span class="c1">// This method gets called whenever subscriber receives a location info of the other user. </span>
    <span class="c1">// You will receive their location info in a `CLLocation` object.</span>
    <span class="kd">func</span> <span class="nf">publisher</span><span class="p">(</span><span class="n">_</span> <span class="nv">subscriber</span><span class="p">:</span> <span class="kt">Subscriber</span><span class="p">,</span> <span class="n">receivedLocation</span> <span class="nv">location</span><span class="p">:</span> <span class="kt">CLLocation</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">timestampString</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">description</span><span class="se">)</span><span class="s">"</span>
        <span class="k">let</span> <span class="nv">coordinatesString</span> <span class="o">=</span> <span class="s">"(</span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">latitude</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">location</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span><span class="se">)</span><span class="s">)"</span>
        <span class="k">let</span> <span class="nv">speedString</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="kt">Int</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="nf">rounded</span><span class="p">(</span><span class="o">.</span><span class="n">up</span><span class="p">))</span><span class="se">)</span><span class="s"> Km/h"</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Other user was passing </span><span class="se">\(</span><span class="n">coordinatesString</span><span class="se">)</span><span class="s"> on </span><span class="se">\(</span><span class="n">timestampString</span><span class="se">)</span><span class="s"> with </span><span class="se">\(</span><span class="n">speedString</span><span class="se">)</span><span class="s"> speed."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='contributing' class='heading'>Contributing</h2>

<p>Contributions are very welcome 🙌</p>
<h2 id='license' class='heading'>License</h2>

<p>License is available in LICENSE file.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>Copyright 1398 Map</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
